# 调用链分析（Call Chain Analysis）

## 目标
通过沿着堆栈调用路径逐层分析接口与函数的输入输出，定位异常最早出现的位置。

## 适用场景
- 异常出现在深层调用栈
- 日志显示错误发生在“下游模块”
- 不清楚是哪个模块最先返回了异常数据

## 方法论步骤

1. **获取完整堆栈信息**
   - 捕获异常堆栈（Stack Trace）
   - 记录所有调用层级

2. **从异常点向上回溯**
   - 从报错函数开始，逐层向上分析调用方
   - 关注每一层的返回值是否符合预期

3. **验证关键接口输出**
   - 对每一层函数/接口输出增加日志或断点
   - 比对「实际值 vs 设计期望值」

4. **定位首次异常返回点**
   - 找到第一个产生“错误/空/非法数据”的函数
   - 该点通常是根因所在

## 常用工具
- Trace / Debugger
- 日志增强（request_id、span_id）
- 分布式链路追踪（如 OpenTelemetry）

## 核心原则
> ❗ 永远从“最早出现异常的返回值”开始修，而不是从最后报错点修。
