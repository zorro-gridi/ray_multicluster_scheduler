# 状态转换调试（State Transition Debugging）

## 目标
排查状态机在转换过程中出现的非法跳转、遗漏跳转或重复跳转问题。

## 适用场景
- 系统卡在某个状态不动
- 出现“不可能”的状态组合
- 状态变更与业务预期不一致

## 方法论步骤

1. **绘制状态机模型**
   - 明确所有状态（State）
   - 明确合法转换路径（Transition）

2. **标记每一次状态变化**
   - 在代码中统一打点：
     ```text
     from=STATE_A -> to=STATE_B
     ```

3. **校验转换合法性**
   - 每次状态变更都校验：
     - 是否允许该路径
     - 是否满足前置条件

4. **查找异常跳转点**
   - 找到第一个：
     - 跳过状态
     - 回退状态
     - 非法跨状态

5. **回溯触发事件**
   - 是谁触发了这次状态变更？
   - 是否并发/重入/重复触发？

## 常用工具
- FSM 可视化图
- 状态日志审计
- 并发锁/事务跟踪

## 核心原则
> ❗ 所有异常状态，都是由一次“非法或缺失的转换”引起的。
